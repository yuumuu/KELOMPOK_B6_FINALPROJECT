<%- include('partials/header', { title: 'Thread' , db_status: db_status }) %>

    <div class="px-4 pt-4 pb-2 border-b border-neutral-800">
        <div class="flex gap-3 items-center mb-3">
            <img src="https://ui-avatars.com/api/?name=<%= post.name %>&background=random&color=fff&rounded=true"
                class="w-10 h-10 rounded-full" alt="Avatar">
            <div>
                <div class="font-bold text-white text-[15px]">
                    <%= post.name %>
                </div>
                <div class="text-neutral-500 text-sm">@<%= post.username %>
                </div>
            </div>
        </div>

        <div class="text-white text-xl leading-normal mb-4">
            <%= post.content %>
        </div>

        <div class="text-neutral-500 text-sm pb-3 border-b border-neutral-800/50 mb-3">
            <%= new Date(post.created_at).toLocaleString('en-US', { hour: 'numeric' , minute: 'numeric' , day: 'numeric'
                , month: 'short' , year: 'numeric' }) %>
        </div>

        <div class="flex items-center gap-6 text-neutral-500 text-sm mb-2">
            <div class="flex items-center gap-2">
                <span class="font-bold text-white">
                    <%= post.reply_count %>
                </span> Replies
            </div>
            <div class="flex items-center gap-2">
                <span class="font-bold text-white">
                    <%= post.likes %>
                </span> Likes
            </div>
            <div class="ml-auto flex items-center gap-3">
                <form action="/posts/<%= post.id %>/like" method="POST">
                    <button type="submit" class="text-neutral-500 hover:text-pink-500">Like</button>
                </form>
                <form action="/posts/<%= post.id %>/share" method="POST">
                    <button type="submit" class="text-neutral-500 hover:text-green-400">Share</button>
                </form>
                <% if (user && user.id===post.user_id) { %>
                    <a href="/posts/<%= post.id %>/edit" class="text-yellow-400">Edit</a>
                    <form action="/posts/<%= post.id %>?_method=DELETE" method="POST"
                        onsubmit="return confirm('Delete this post?')">
                        <button type="submit" class="text-red-500">Delete</button>
                    </form>
                    <% } %>
            </div>
        </div>
    </div>

    <div class="px-4 py-4 border-b border-neutral-800 bg-neutral-900/30">
        <div class="flex gap-3">
            <img src="https://ui-avatars.com/api/?name=Me&background=random&color=fff&rounded=true"
                class="w-10 h-10 rounded-full" alt="Me">
            <form action="/posts/<%= post.id %>/reply" method="POST" class="w-full">
                <textarea name="content" placeholder="Post your reply" required
                    class="w-full bg-transparent text-white placeholder-neutral-500 focus:outline-none h-10 resize-none py-2"
                    oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"></textarea>
                <div class="flex justify-end mt-2">
                    <button type="submit"
                        class="px-4 py-1.5 bg-white text-black font-bold rounded-full text-sm hover:bg-neutral-200">
                        Reply
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="pb-20">
        <% replies.forEach(reply=> { %>
            <% const threadId=reply.parent_id ? reply.parent_id : reply.id; %>
                <a href="/posts/<%= threadId %>"
                    class="block border-b border-neutral-800 p-4 hover:bg-neutral-900/50 transition duration-200">
                    <div class="flex gap-3">
                        <img src="https://ui-avatars.com/api/?name=<%= reply.name %>&background=random&color=fff&rounded=true"
                            class="w-10 h-10 rounded-full" alt="<%= reply.name %>">
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <div class="flex items-center gap-2">
                                    <span class="font-bold text-white">
                                        <%= reply.name %>
                                    </span>
                                    <span class="text-neutral-500 text-sm">@<%= reply.username %></span>
                                </div>
                                <span class="text-neutral-500 text-xs">
                                    <%= new Date(reply.created_at).toLocaleDateString() %>
                                </span>
                            </div>
                            <div class="text-neutral-200 mt-1 whitespace-pre-wrap">
                                <%= reply.content %>
                            </div>
                        </div>
                    </div>
                </a>
                <% }) %>

                    <% if (replies.length===0) { %>
                        <div class="text-center py-8 text-neutral-600 italic">No replies yet. Be the first!</div>
                        <% } %>
    </div>

    <%- include('partials/footer') %>